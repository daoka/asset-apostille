# Apostille asset

- [English](./README.md)

Apostille assetはモザイクを使った譲渡可能なパブリックアポスティーユです。

## 背景

- NEMのアポスティーユには、公証アカウントを独自に持ち、分割・譲渡・更新が可能なプライベート型と共通の公証アカウントを使い、シンプルにタイムスタンプ公証を行うパブリック型の2種類がある。
- プライベート型のアポスティーユは公証アカウントをマルチシグ化し、公証アカウントに紐付く連署人のアカウントを操作する事によって、アポスティーユの権利の保有を表現することができる。それによって、権利の分割・譲渡の表現を可能にし、これが他のタイムスタンプ公証に比べ優れた点と言われている。
- しかしながら、プライベート型のアポスティーユには以下の課題があると考えられる
  - マルチシグ化前の公証アカウントの秘密鍵の漏洩リスク
    - 実際、アポスティーユ時に作成される証明書をSNSに公開してHDアカウントの秘密鍵を漏らしていたケースがあった。
  - 送金操作に比べ、マルチシグアカウントの更新操作は煩雑である
  - Catapultでは1つのアカウントでマルチシグアカウントの連署人になれる数に制限がある[(※参照)](https://nemtech.github.io/concepts/multisig-account.html) これは、1つのアカウントで受け持つことができるアポスティーユされた権利に制限がかかることを意味する。

## アポスティーユのアセット化による改善

- マルチシグアカウントを使ったアポスティーユは確かに分割・譲渡を行う事が可能であるが、操作性などいくつかの課題がある。そこで別なモザイクを使ったアプローチを検討してみる。

### 実装案

作成したアポスティーユに紐付くモザイクを作成する。紐付けはアポスティーユした際のトランザクションハッシュを使用するが、単純にトランザクションハッシュを紐付けると誰でも容易に偽の紐付けモザイクを作成することが出来てしまうため、アポスティーユを作成したアカウントの秘密鍵でトランザクションハッシュを署名し、生成した文字列をネームスペース・モザイク名に適用することで紐付けることにする。
具体的には以下の要領で実装する。

1. アポスティーユを作成する
2. アポスティーユした際のトランザクションハッシュをアポスティーユを作成したアカウントの秘密鍵で署名する
3. 署名した文字列を以下の様に分割して、ネームスペースを作成する
    - (任意のルートネームスペース).署名済みのTxHashの先頭64桁.署名済みのTxHashの65桁目から32桁
4. モザイクを以下の要領で作成する
    - モザイク名: 署名済みのTxHashの最後の32桁
    - 説明: アポスティーユ時のTxHashの平文
    - 供給量数: 権利の数だけ発行する
    - 可分性: 0
    - 供給量転送可否: 後から分割・併合があり得る場合は可にする
    - 転送可否: アセット・権利の形態に応じて設定する
    - Levy: 基本的に不要だが、厳密なマーキングを行う必要がある場合は設定する。

- [サンプル実装](./sample)

### 監査

発行したモザイクがアポスティーユ作成者が作成したものであるかは、サブネームスペース、モザイク名の文字列を結合し、復元した署名済みのトランザクションとモザイクの説明文にある元のトランザクションハッシュとアポスティーユ作成者の公開鍵を使い行う。

### モザイクを利用するメリット

- 権利の譲渡をモザイクを転送するのと同じ要領で行う事ができる。
- モザイクを使うため、マルチシグを使った場合より分割数を多くすることができる。
  - マルチシグ: 最大32, モザイク: 最大90億(整数のみの場合)
- 公証アカウントが共通のパブリックアポスティーユにも適用できる。
- Catapultの際にも、1つのアカウントで保有できる権利の制限を受けない。

### モザイクを利用した際のデメリット

- マルチシグ型に比べて手数料が高い。
- ネームスペース作成者がネームスペースの更新を怠った場合、権利の表現が消失してしまう。

## ユースケース

従来のプライベートのアポスティーユと同様の利用方法ができるが、モザイクを使うことでさらに以下の様な拡張が考えられる

- 共有持ち分の持ち分数も含めた保有権利の表現
- ゲームアイテムなど大量に発行する必要があるものへの適用

## NEM2(Catapult)での実装

### この提案で影響を受けるNEM2(Catapult)の機能追加・変更

- モザイクとネームスペースの切り離し。ネームスペースなしでもモザイクを作成できるようになり、後からネームスペースを紐付ける流れとなる。(※cowにて変更予定)
- メタデータ機能の追加。モザイク、ネームスペース、アカウント、トランザクションにKey/Valueのデータを紐付けられるようになる (※Eにて追加予定)

### NEM2(Catapult)での実装案

1. アポスティーユを行う
2. モザイクの作成を行う。モザイクのプロパティはNEM1と同じように設定するが、モザイクのメタデータに以下の内容を設定する
    - OriginalHash: アポスティーユ作成時のTxHash
    - SignedHash: OriginalHashをアポスティーユを作成したアカウントの秘密鍵で署名し生成された文字列
3. ネームスペースは任意のものを紐付けることができる

### NEN2(Catapult)でのアポスティーユ拡張

NEM2(Catapult)に追加されるメタデータを活用すると、メタデータ上にオリジナルのドキュメントが所在するURLや作者、承認者の情報、権利の概要などのデータをアポスティーユモザイクに入れる事ができるようになると思われる。